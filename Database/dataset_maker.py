# -*- coding: utf-8 -*-
"""Final.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Msrc1TFNCHeuOw59unqHzsCxWIVU-7wf
"""
import pandas as pd
import numpy as np
import csv
import seaborn as sns
from matplotlib import pyplot as plt
from sklearn.model_selection import train_test_split

FilePath = './weatherAUS.csv'

DF = pd.read_csv(FilePath,delimiter=',')
DF = DF.drop( columns=['RISK_MM'])

columns = DF.columns

DF=DF.sort_values(by=['Date'])
DF['Date'] = pd.to_datetime(DF['Date'])
DF['Year'] = DF['Date'].dt.year
DF['Month'] = DF['Date'].dt.month
DF['Day'] = DF['Date'].dt.day
DF=DF.drop(['Date'],axis=1)
DF.info()

y = DF[['RainTomorrow']]
X = DF.drop(columns = ['RainTomorrow'])

X,y

numerical_col = [i for i in X.columns if (X[i].dtype=='float64' or X[i].dtype=='int64')]
objects_col = [i for i in X.columns if X[i].dtype=='object']

y = y.replace(to_replace={'Yes':1,'No':0})

DF["Date-time"] = pd.to_datetime(pd.DataFrame({"year":DF["Year"],
                                                "month":DF["Month"],
                                                "day":DF["Day"]}))
columns = DF.columns    
   
# WEEKLY DATASET ----------------------------------------------
numdays = 14
week_dataset_columns = [str(k)+"_"+str(i) for k in range(1,numdays+1) for i in list(columns)]   

week_dataset = []    
print(len(week_dataset_columns))

def is_week(t):
    for i in range(numdays-1):
        if t[i+1,-1]-t[i,-1]!= np.timedelta64(1,"D"):
            return False

    return True

for loc in DF["Location"].unique():
    temp = DF[DF.Location==loc]
    temp = temp.sort_values(by=["Date-time"])
    temp = temp.to_numpy()

    for i in range(len(temp)-(numdays-1)):
        t = temp[i:i+numdays]
        if is_week(t):
            t = np.reshape(t,(-1,len(week_dataset_columns)))
            week_dataset.append([t])

    print("Completed Location",loc, "with",len(week_dataset),"rows")

week_dataset = np.reshape(np.array(week_dataset),(-1,len(week_dataset_columns)))
week_dataset = pd.DataFrame(week_dataset,columns=week_dataset_columns)

print(week_dataset)
print(week_dataset.shape)
week_dataset.to_csv(r"./+str(numdays)+day_data.csv",sep=",",index=False,)


# -------------------------------------------------------